# Guia de Implanta√ß√£o e Integra√ß√£o (API Alerta ES)

Este documento detalha a arquitetura constru√≠da e serve como manual de implanta√ß√£o do motor de extra√ß√£o de dados da Defesa Civil do Estado (ES) focado no munic√≠pio de **Santa Maria de Jetib√°**, para integra√ß√£o direta com a plataforma **SIGERD**.

---

## üèóÔ∏è 1. Arquitetura da Solu√ß√£o

O sistema foi dividido em duas camadas independentes (desacopladas), o que facilita a manuten√ß√£o e escalabilidade:

### A. Back-end (O Motor / API)
*   **Linguagem/Framework:** Python 3 com FastAPI.
*   **Objetivo:** Agir de forma invis√≠vel no servidor. Ele navega pelos sites `alerta.es.gov.br`, l√™ o HTML (via `BeautifulSoup`), baixa os PDFs de ocorr√™ncia na mem√≥ria (sem salvar no disco) e extrai o texto interno usando o pacote `pypdf`.
*   **Intelig√™ncia:** Utiliza Express√µes Regulares (RegEx) para transformar frases soltas nos PDFs em dados estruturados (separando, por exemplo, o nome do munic√≠pio do √≠ndice pluviom√©trico `14.8 mm`).
*   **Sa√≠da:** Retorna todos os dados "mastigados" em formato **JSON** pelas portas HTTP.

### B. Front-end (O Cliente / SIGERD)
*   **Linguagem:** HTML, JavaScript Vanilla (requisi√ß√µes `fetch()`) e Tailwind CSS para design.
*   **Objetivo:** Requisitar os dados do painel traseiro via HTTP GET e injet√°-los no DOM (tela) instantaneamente.

---

## üöÄ 2. Como Hospedar a API na Nuvem (Produ√ß√£o)

Para que o aplicativo SIGERD e seus dispositivos m√≥veis tenham acesso a esta API 24/7 de qualquer lugar, o c√≥digo gerado ([scraper_api.py](file:///c:/Users/Coord01/Desktop/alertaes/scraper_api.py) e [requirements.txt](file:///c:/Users/Coord01/Desktop/alertaes/requirements.txt)) precisa residir em um Ambiente de Nuvem (Cloud).

### Passo a Passo Recomendado (Render.com, Railway ou AWS EC2):

1.  **Versionamento:** Crie um reposit√≥rio no GitHub (ou similar) e suba apenas dois arquivos:
    *   [scraper_api.py](file:///c:/Users/Coord01/Desktop/alertaes/scraper_api.py) (c√≥digo-fonte)
    *   [requirements.txt](file:///c:/Users/Coord01/Desktop/alertaes/requirements.txt) (lista de depend√™ncias como `fastapi`, `uvicorn`, `beautifulsoup4`, `pypdf`, `requests`)
2.  **Plataforma Cloud (Exemplo: Render):**
    *   Crie um "New Web Service" e vincule ao reposit√≥rio do GitHub.
    *   Em **Build Command**, coloque: `pip install -r requirements.txt`
    *   Em **Start Command**, coloque: `uvicorn scraper_api:app --host 0.0.0.0 --port $PORT`
3.  **Resultado da Implanta√ß√£o:** A plataforma ir√° instalar o Python e gerar um link fixo HTTPS seguro (Ex: `https://api-alerta-smj.onrender.com`).

---

## üîå 3. Como Integrar no Front-end (Aplica√ß√£o SIGERD atual)

Com o link da API p√∫blica gerado, a implanta√ß√£o na sua aplica√ß√£o existente (SIGERD) √© atrav√©s de simples requisi√ß√µes Ass√≠ncronas.

### A. Lendo os Avisos em Tempo Real (Pain√©is Centrais)
Voc√™ dever√° focar o seu sistema para chamar periodicamente a Rota de `Alertas`.

```javascript
// Exemplo em um Componente do SIGERD (React, Vue, etc)
fetch("https://SUA_API_NA_NUVEM.com/api/alertas?filtro_serrana=true")
  .then(response => response.json())
  .then(data => {
      let avisosAtivos = data.dados_extraidos;
      let totalAlertas = avisosAtivos.length;
      
      // Atualiza o card de avisos: document.getElementById('contador').innerText = totalAlertas;
  });
```

### B. Extraindo o Pluvi√¥metro do PDF (Relat√≥rios de Campo)
A Rota de extra√ß√£o do PDF ir√° baixar e analisar o documento oficial automaticamente:

```javascript
fetch("https://SUA_API_NA_NUVEM.com/api/boletim-serrana")
  .then(response => response.json())
  .then(data => {
      // Retorna o link oficial para download do PDF inteiro
      let urlDocumentoDefesaCivil = data.url_oficial; 
      
      // Retorna em Array tudo que achou de Chuva para SMJ
      let indicesDeChuva = data.chuvas_regiao_serrana; 
      // Ex: ["Santa Maria De Jetib√°: 20.4 mm"]
  });
```

---

## üõ†Ô∏è 4. Fluxograma Operacional Di√°rio

1. Ocasionalmente, o Estado cadastra informa√ß√µes no Portal Defesa Civil ES e emite Novos PDFs.
2. O Servidor da Nuvem do SIGERD (Python/FastAPI) fica silencioso aguardando pedidos.
3. O Coordenador (Bruno Pagel) abre o painel web ou o App do SIGERD.
4. O App SIGERD efetua as chamadas HTTP (Fetch) para a Nuvem de Monitoramento.
5. Em menos de 1.5 segundos, a Nuvem raspa os sites do governo, l√™ os PDFs e devolve respostas.
6. A interface SIGERD carrega.

### Pontos de Aten√ß√£o na Implanta√ß√£o
*   **Mudan√ßas Estaduais:** Se o Governo do ES refizer o design inteiro do site estadual `alerta.es.gov.br`, a API em Python precisar√° de manuten√ß√£o na sua l√≥gica de `BeautifulSoup` para encontrar os novos cantos escondidos do site governamental.
*   **Limites de Requisi√ß√£o:** Para evitar banimento tempor√°rio do IP da sua hospedagem pelos servidores do Estado, o ideal √© que a interface do seu sistema n√£o bombardeie a API de extra√ß√£o toda hora. Mantenha os rob√¥s buscando atualiza√ß√µes com pelo menos 5 a 10 minutos de intervalo.
